<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Приблизительный расчёт ремонта — FinishPerfekt</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #d35400;
      --primary-dark: #a04000;
      --secondary: #2c3e50;
      --bg: #fdf6f0;
      --card-bg: #ffffff;
      --text: #2c3e50;
      --price: #27ae60;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      padding: 16px;
      margin: 0;
      color: var(--text);
    }
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 24px;
      margin: 12px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    h2 {
      font-size: 22px;
      margin: 0 0 20px;
      color: var(--secondary);
      text-align: center;
    }
    label {
      display: block;
      margin: 14px 0 8px;
      font-weight: 600;
      font-size: 16px;
    }
    input, select {
      width: 100%;
      padding: 14px;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      box-sizing: border-box;
      background: #fcfcfc;
    }
    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 10px;
    }
    .checkbox-item {
      flex: 1 1 45%;
      min-width: 140px;
    }
    .checkbox-item label {
      margin: 0;
      font-weight: normal;
      display: flex;
      align-items: flex-start;
      cursor: pointer;
      flex-direction: column;
      align-items: start;
    }
    .checkbox-item input[type="checkbox"] {
      width: auto;
      margin: 0 0 6px 0;
      accent-color: var(--primary);
    }
    .checkbox-item input[type="number"] {
      margin-top: 4px;
      width: 80px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }
    #result {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary-dark);
      margin: 20px 0;
      padding: 16px;
      background: #fff8e1;
      border-radius: 14px;
      text-align: center;
      border-left: 4px solid var(--primary);
    }
    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 18px;
      border-radius: 14px;
      font-size: 18px;
      width: 100%;
      font-weight: 600;
      margin-top: 12px;
      transition: background 0.2s;
      font-family: 'Inter', sans-serif;
    }
    button:hover {
      background: var(--primary-dark);
    }
    .btn-contact {
      background: #27ae60;
    }
    .btn-contact:hover {
      background: #219653;
    }
    .section {
      border-top: 1px solid #f0f0f0;
      padding-top: 20px;
      margin-top: 20px;
    }
    .section-title {
      font-weight: 700;
      margin: 0 0 16px;
      color: var(--secondary);
      font-size: 18px;
    }
    .price-note {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
      font-weight: 500;
    }
    .tab-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 16px 0;
    }
    .tab-button {
      padding: 14px;
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      cursor: pointer;
      text-align: center;
      flex: 1 1 180px;
      min-width: 120px;
      font-weight: 600;
      font-size: 15px;
      transition: all 0.2s;
    }
    .tab-button.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Приблизительный расчёт ремонта</h2>

    <label>Площадь квартиры (м²):</label>
    <input type="number" id="area" placeholder="Например: 52" min="20" max="200" value="52">

    <label>Количество комнат:</label>
    <select id="rooms">
      <option value="1">1-комнатная</option>
      <option value="2" selected>2-комнатная</option>
      <option value="3">3-комнатная</option>
    </select>

    <label>Тип ремонта:</label>
    <select id="repairType">
      <option value="cosmetic">Косметический</option>
      <option value="capital" selected>Капитальный</option>
      <option value="euro">Евро / Дизайнерский</option>
    </select>

    <div class="tab-buttons">
      <div class="tab-button active" onclick="showSection('Монтаж потолков', this)">Монтаж потолков</div>
      <div class="tab-button" onclick="showSection('Монтаж стен', this)">Монтаж стен</div>
      <div class="tab-button" onclick="showSection('Демонтаж стен', this)">Демонтаж стен</div>
      <div class="tab-button" onclick="showSection('Монтаж полов', this)">Монтаж полов</div>
      <div class="tab-button" onclick="showSection('Работы с гипсокартоном', this)">Работы с гипсокартоном</div>
      <div class="tab-button" onclick="showSection('Монтаж кафеля', this)">Монтаж кафеля</div>
      <div class="tab-button" onclick="showSection('Стоимость декоративных работ', this)">Стоимость декоративных работ</div>
      <div class="tab-button" onclick="showSection('Электромонтажные работы', this)">Электромонтажные работы</div>
      <div class="tab-button" onclick="showSection('Монтаж сантехники', this)">Монтаж сантехники</div>
      <div class="tab-button" onclick="showSection('Монтаж дверных конструкций', this)">Монтаж дверных конструкций</div>
      <div class="tab-button" onclick="showSection('Стоимость прочих работ', this)">Стоимость прочих работ</div>
    </div>

    <div id="works"></div>

    <div id="result">Смета появится здесь</div>

    <button onclick="sendData()">Отправить смету менеджеру</button>
    <button class="btn-contact" onclick="callMaster()">
      Связаться с мастером
    </button>
  </div>

  <script>
    const WORKS_DATA = {
      "Монтаж потолков": [
        { "name": "Грунтовка потолка", "unit": "м²", "price": 60 },
        { "name": "Шпатлевка потолка под покраску", "unit": "м²", "price": 280 },
        { "name": "Покраска потолка", "unit": "м²", "price": 350 },
        { "name": "Монтаж ГКЛ на потолок (1 уровень)", "unit": "м²", "price": 700 },
        { "name": "Монтаж ГКЛ на потолок (2 уровня)", "unit": "м²", "price": 1000 },
        { "name": "Установка натяжного потолка", "unit": "м²", "price": 450 }
      ],
      "Монтаж стен": [
        { "name": "Грунтовка стен", "unit": "м²", "price": 60 },
        { "name": "Штукатурка стен по маякам", "unit": "м²", "price": 500 },
        { "name": "Шпатлевка стен под обои", "unit": "м²", "price": 250 },
        { "name": "Шпатлевка стен под покраску", "unit": "м²", "price": 300 },
        { "name": "Поклейка обоев без подбора рисунка", "unit": "м²", "price": 200 },
        { "name": "Поклейка обоев с подбором рисунка", "unit": "м²", "price": 250 },
        { "name": "Покраска стен", "unit": "м²", "price": 220 }
      ],
      "Демонтаж стен": [
        { "name": "Очистка стен от обоев", "unit": "м²", "price": 80 },
        { "name": "Демонтаж штукатурки со стен", "unit": "м²", "price": 135 },
        { "name": "Демонтаж плитки со стен", "unit": "м²", "price": 150 },
        { "name": "Очистка стен от краски, шпатлёвки, побелки", "unit": "м²", "price": 150 },
        { "name": "Демонтаж перегородок из ГКЛ", "unit": "м²", "price": 160 },
        { "name": "Демонтаж перегородок из кирпича", "unit": "м²", "price": 400 },
        { "name": "Демонтаж перегородок из сибита", "unit": "м²", "price": 350 }
      ],
      "Монтаж полов": [
        { "name": "Устройство стяжки пола (до 5 см)", "unit": "м²", "price": 400 },
        { "name": "Выравнивание пола самонивелиром", "unit": "м²", "price": 250 },
        { "name": "Укладка ламината", "unit": "м²", "price": 400 },
        { "name": "Укладка паркетной доски", "unit": "м²", "price": 600 },
        { "name": "Укладка линолеума", "unit": "м²", "price": 250 },
        { "name": "Укладка кварцвинила", "unit": "м²", "price": 380 },
        { "name": "Установка напольного плинтуса (пластик)", "unit": "м.п.", "price": 100 }
      ],
      "Работы с гипсокартоном": [
        { "name": "Монтаж перегородки из ГКЛ (1 слой)", "unit": "м²", "price": 500 },
        { "name": "Монтаж перегородки из ГКЛ (2 слоя)", "unit": "м²", "price": 600 },
        { "name": "Монтаж короба из ГКЛ", "unit": "м.п.", "price": 800 },
        { "name": "Шпатлевка ГКЛ под покраску", "unit": "м²", "price": 450 },
        { "name": "Шпатлевка ГКЛ под обои", "unit": "м²", "price": 300 },
        { "name": "Установка закладных под светильники", "unit": "шт", "price": 500 }
      ],
      "Монтаж кафеля": [
        { "name": "Укладка керамической плитки на стены", "unit": "м²", "price": 1000 },
        { "name": "Укладка керамической плитки на пол", "unit": "м²", "price": 1000 },
        { "name": "Укладка керамогранита на пол", "unit": "м²", "price": 1200 },
        { "name": "Затирка швов плитки", "unit": "м²", "price": 150 },
        { "name": "Гидроизоляция пола", "unit": "м²", "price": 80 }
      ],
      "Стоимость декоративных работ": [
        { "name": "Нанесение декоративной штукатурки", "unit": "м²", "price": 500 },
        { "name": "Нанесение венецианской штукатурки", "unit": "м²", "price": 700 },
        { "name": "Облицовка стен вагонкой", "unit": "м²", "price": 450 },
        { "name": "Облицовка стен ПВХ панелями", "unit": "м²", "price": 300 },
        { "name": "Установка зеркала", "unit": "шт", "price": 350 }
      ],
      "Электромонтажные работы": [
        { "name": "Штробление в кирпиче", "unit": "м.п.", "price": 100 },
        { "name": "Штробление в бетоне", "unit": "м.п.", "price": 180 },
        { "name": "Прокладка кабеля 3×1.5 / 3×2.5", "unit": "м.п.", "price": 60 },
        { "name": "Монтаж розетки / выключателя", "unit": "шт", "price": 150 },
        { "name": "Монтаж люстры", "unit": "шт", "price": 500 },
        { "name": "Монтаж точечного светильника", "unit": "шт", "price": 250 },
        { "name": "Монтаж распределительного щита (до 24 мод)", "unit": "шт", "price": 2000 }
      ],
      "Монтаж сантехники": [
        { "name": "Прокладка труб водоснабжения (металлопластик)", "unit": "м.п.", "price": 70 },
        { "name": "Прокладка канализационных труб", "unit": "м.п.", "price": 70 },
        { "name": "Установка смесителя", "unit": "шт", "price": 300 },
        { "name": "Установка унитаза напольного", "unit": "шт", "price": 1000 },
        { "name": "Установка унитаза подвесного", "unit": "шт", "price": 1500 },
        { "name": "Установка раковины", "unit": "шт", "price": 800 },
        { "name": "Установка ванны", "unit": "шт", "price": 1200 },
        { "name": "Установка душевой кабины", "unit": "шт", "price": 2500 },
        { "name": "Установка полотенцесушителя", "unit": "шт", "price": 800 },
        { "name": "Установка водонагревателя", "unit": "шт", "price": 1000 },
        { "name": "Монтаж сантехнического люка", "unit": "шт", "price": 250 }
      ],
      "Монтаж дверных конструкций": [
        { "name": "Установка межкомнатной двери (стандарт)", "unit": "шт", "price": 3000 },
        { "name": "Установка подоконника", "unit": "м.п.", "price": 350 },
        { "name": "Установка ПВХ откосов", "unit": "м.п.", "price": 380 },
        { "name": "Устройство арки из ГКЛ", "unit": "шт", "price": 3000 },
        { "name": "Установка дверного замка", "unit": "шт", "price": 1000 },
        { "name": "Установка ручки", "unit": "шт", "price": 600 }
      ],
      "Стоимость прочих работ": [
        { "name": "Демонтаж унитаза", "unit": "шт", "price": 300 },
        { "name": "Демонтаж ванны", "unit": "шт", "price": 500 },
        { "name": "Демонтаж смесителя", "unit": "шт", "price": 150 },
        { "name": "Установка стиральной машины", "unit": "шт", "price": 1000 },
        { "name": "Установка посудомоечной машины", "unit": "шт", "price": 1000 },
        { "name": "Установка терморегулятора (тёплый пол)", "unit": "шт", "price": 650 },
        { "name": "Установка светодиодной ленты", "unit": "м.п.", "price": 250 },
        { "name": "Установка гардины", "unit": "шт", "price": 300 },
        { "name": "Установка подвесного светильника", "unit": "шт", "price": 500 },
        { "name": "Установка настенного светильника", "unit": "шт", "price": 500 }
      ]
    };

    let currentQuantities = {};
    let activeSection = "Монтаж потолков";

    function showSection(sectionName, buttonElement) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      buttonElement.classList.add('active');
      activeSection = sectionName;
      renderWorks();
    }

    function renderWorks() {
      const area = parseFloat(document.getElementById("area").value) || 0;
      const rooms = document.getElementById("rooms").value;
      let html = '';

      if (WORKS_DATA[activeSection]) {
        html += `<div class="section"><div class="section-title">${activeSection}</div><div class="checkbox-group">`;

        WORKS_DATA[activeSection].forEach((item, idx) => {
          const key = `${activeSection}_${idx}`.replace(/\s+/g, '_').toLowerCase();
          const isSquare = item.unit === "м²";
          let qty = currentQuantities[key]?.qty || 0;

          if (qty === 0 && document.getElementById("repairType").value === "capital") {
            if (isSquare) {
              qty = Math.round(area * 0.8);
            } else if (item.name.includes("дверь")) {
              qty = parseInt(rooms) + 1;
            } else if (item.name.includes("розетка")) {
              qty = Math.round(area * 0.3);
            } else if (item.name.includes("люстра")) {
              qty = Math.round(area / 20);
            } else {
              qty = 1;
            }
          }

          html += `
            <div class="checkbox-item">
              <label>
                <input type="checkbox" id="work_${key}" 
                  ${currentQuantities[key] && currentQuantities[key].qty > 0 ? 'checked' : ''} 
                  onchange="toggleWork('${key}', this.checked, ${item.price}, '${item.unit}')">
                ${item.name}
              </label>
              <div class="price-note">${item.price} ₽ / ${item.unit}</div>
              ${isSquare ? `<input type="number" id="qty_${key}" value="${qty}" min="0" onchange="updateQty('${key}', this.value)">` : ''}
            </div>
          `;
        });

        html += '</div></div>';
      }

      document.getElementById("works").innerHTML = html;
      calculate();
    }

    function toggleWork(key, checked, price, unit) {
      const qtyInput = document.getElementById(`qty_${key}`);
      if (checked) {
        const area = parseFloat(document.getElementById("area").value) || 50;
        const rooms = document.getElementById("rooms").value;
        let qty = 1;

        if (unit === "м²") {
          qty = Math.round(area * 0.8);
        } else if (price <= 1000 && !isNaN(area)) {
          if (key.includes("дверь")) {
            qty = parseInt(rooms) + 1;
          } else if (key.includes("розетка")) {
            qty = Math.round(area * 0.3);
          } else if (key.includes("люстра")) {
            qty = Math.round(area / 20);
          }
        }

        currentQuantities[key] = { qty, price, unit };
        if (qtyInput) qtyInput.value = qty;
      } else {
        currentQuantities[key] = { qty: 0, price, unit };
        if (qtyInput) qtyInput.value = 0;
      }
      calculate();
    }

    function updateQty(key, value) {
      const qty = parseFloat(value) || 0;
      currentQuantities[key] = {
        ...(currentQuantities[key] || {}),
        qty: qty
      };
      calculate();
    }

    function calculate() {
      let total = 0;
      Object.values(currentQuantities).forEach(item => {
        if (item.qty > 0) {
          total += item.qty * item.price;
        }
      });
      const formatted = new Intl.NumberFormat('ru-RU').format(total);
      document.getElementById("result").innerText = `Итого: ${formatted} ₽`;
    }

    function sendData() {
      const details = [];
      let totalSum = 0;

      Object.entries(currentQuantities).forEach(([key, item]) => {
        if (item.qty > 0) {
          const label = document.querySelector(`label[for="work_${key}"]`);
          const name = label ? label.textContent.trim().replace(/\s*\d+ ₽.*$/, '') : key;
          const lineTotal = item.qty * item.price;
          details.push(`${item.qty} ${item.unit} × ${item.price} ₽ = ${lineTotal} ₽ — ${name}`);
          totalSum += lineTotal;
        }
      });

      if (details.length === 0) {
        alert("Выберите хотя бы одну работу.");
        return;
      }

      const area = document.getElementById("area").value;
      const rooms = document.getElementById("rooms").value;
      const repairType = document.getElementById("repairType").value;
      const date = new Date().toLocaleString('ru-RU');

      const textContent = `
Смета от ${date}
Площадь: ${area} м² | Комната: ${rooms} | Тип ремонта: ${repairType}

Работы:
${details.join('\n')}

Итого: ${new Intl.NumberFormat('ru-RU').format(totalSum)} ₽

---
Сохранено автоматически.
      `;

      const blob = new Blob([textContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `смета_${date.replace(/[:\s]/g, '_')}.txt`;
      a.click();

      const WebApp = window.Telegram.WebApp;
      WebApp.sendData(JSON.stringify({
        area: area,
        rooms: rooms,
        repairType: repairType,
        total: totalSum,
        details: details
      }));
      WebApp.close();
    }

    function callMaster() {
      window.Telegram.WebApp.openTelegramLink("https://t.me/grigorii_saveliev");
    }

    document.getElementById("area").addEventListener("input", renderWorks);
    document.getElementById("rooms").addEventListener("change", renderWorks);
    document.getElementById("repairType").addEventListener("change", renderWorks);
    renderWorks();
  </script>
</body>
</html>