<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –°–º–µ—Ç—ã (DEBUG)</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box;}
        button { width: 100%; padding: 20px; background: #d35400; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        button:active { background: #a04000; transform: scale(0.98); } /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
        .item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="card">
    <h2>–î–ò–ê–ì–ù–û–°–¢–ò–ö–ê</h2>
    <p style="color:red; font-size: 12px;">–ï—Å–ª–∏ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω –Ω–µ—Ç ‚Äî —Å–∫—Ä–∏–ø—Ç —Å–ª–æ–º–∞–Ω.</p>
    
    <label>–ü–ª–æ—â–∞–¥—å (–º¬≤):</label>
    <input type="number" id="area" value="50">

    <h3>–†–∞–±–æ—Ç—ã:</h3>
    <div id="list"></div>

    <h3 id="total">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</h3>

    <button onclick="debugSend()">üöÄ –û–¢–ü–†–ê–í–ò–¢–¨ (–¢–ï–°–¢)</button>
    <br><br>
    <button onclick="window.location.reload()" style="background: #7f8c8d;">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
</div>

<script>
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ —Å–∫—Ä–∏–ø—Ç –¢–µ–ª–µ–≥—Ä–∞–º–∞
    let tg;
    try {
        tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        // alert("‚úÖ –¢–µ–ª–µ–≥—Ä–∞–º –ø–æ–¥–∫–ª—é—á–µ–Ω"); // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ —Å–æ–≤—Å–µ–º –≤—Å—ë –≥–ª—É—Ö–æ
    } catch (e) {
        alert("‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TG: " + e.message);
    }

    // –î–∞–Ω–Ω—ã–µ
    const SERVICES = [
        { name: "–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞", price: 900 },
        { name: "–°—Ç—è–∂–∫–∞", price: 600 }
    ];
    let cart = {};

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
    const listEl = document.getElementById('list');
    SERVICES.forEach((service) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.innerHTML = `
            <span>${service.name} (${service.price}‚ÇΩ)</span>
            <input type="checkbox" onchange="toggle('${service.name}', ${service.price}, this.checked)">
        `;
        listEl.appendChild(div);
    });

    function toggle(name, price, checked) {
        if (checked) cart[name] = price;
        else delete cart[name];
        calc();
    }

    function calc() {
        let sum = 0;
        Object.values(cart).forEach(p => sum += p);
        document.getElementById('total').innerText = `–ò—Ç–æ–≥–æ: ${sum} ‚ÇΩ`;
    }

    // --- –§–£–ù–ö–¶–ò–Ø –° –î–ò–ê–ì–ù–û–°–¢–ò–ö–û–ô ---
    function debugSend() {
        alert("1Ô∏è‚É£ –ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞! –ù–∞—á–∏–Ω–∞–µ–º —Å–±–æ—Ä–∫—É...");

        try {
            const area = document.getElementById('area').value;
            let items = [];
            let totalSum = 0;

            for (let [name, price] of Object.entries(cart)) {
                items.push({ name: name, qty: 1, line_sum: price });
                totalSum += price;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
            if (items.length === 0) {
                alert("‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –≥–∞–ª–æ—á–∫—É!");
                return;
            }

            alert("2Ô∏è‚É£ –î–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã. –°—É–º–º–∞: " + totalSum);

            const dataToSend = {
                area: area,
                total: totalSum + " ‚ÇΩ",
                items: items
            };
            
            const jsonString = JSON.stringify(dataToSend);
            alert("3Ô∏è‚É£ JSON –≥–æ—Ç–æ–≤. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ TG...");

            // –°–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç
            if (!tg) {
                alert("‚ùå –û–®–ò–ë–ö–ê: –û–±—ä–µ–∫—Ç 'tg' –Ω–µ –Ω–∞–π–¥–µ–Ω. –í—ã –æ—Ç–∫—Ä—ã–ª–∏ —ç—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ?");
                return;
            }
            
            tg.sendData(jsonString);
            alert("4Ô∏è‚É£ sendData –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! –û–∫–Ω–æ –¥–æ–ª–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å—Å—è.");

        } catch (error) {
            alert("üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê JS:\n" + error.message);
        }
    }
</script>

</body>
</html>