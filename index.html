<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–º–æ–Ω—Ç–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #fdf6f0; padding: 16px; margin: 0; color: #2c3e50; }
    .card { background: #fff; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { text-align: center; margin-bottom: 20px; }
    label { display: block; font-weight: 600; margin: 10px 0 5px; }
    input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
    
    .tab-buttons { display: flex; overflow-x: auto; gap: 10px; margin: 15px 0; padding-bottom: 5px; scrollbar-width: none; }
    .tab-button { padding: 8px 15px; background: #eee; border-radius: 8px; white-space: nowrap; cursor: pointer; font-size: 14px; font-weight: 600; }
    .tab-button.active { background: #d35400; color: white; }
    
    .work-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
    .price { font-size: 12px; color: #7f8c8d; }
    input[type="checkbox"] { width: 22px; height: 22px; accent-color: #d35400; }
    
    #result { font-size: 22px; font-weight: bold; color: #d35400; text-align: center; padding: 15px; background: #fff3e0; border-radius: 10px; margin-top: 20px; }
    button { background: #d35400; color: white; width: 100%; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; margin-top: 15px; }
  </style>
</head>
<body>

<div class="card">
  <h2>–†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏</h2>

  <label>–ü–ª–æ—â–∞–¥—å (–º¬≤)</label>
  <input type="number" id="area" value="50" oninput="calc()">

  <label>–ö–æ–º–Ω–∞—Ç—ã</label>
  <select id="rooms">
    <option value="1">1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</option>
    <option value="2" selected>2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</option>
    <option value="3">3-–∫–æ–º–Ω–∞—Ç–Ω–∞—è</option>
    <option value="4+">4+ –∫–æ–º–Ω–∞—Ç</option>
  </select>
  
  <label>–¢–∏–ø —Ä–µ–º–æ–Ω—Ç–∞</label>
  <select id="repairType">
    <option>–ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π</option>
    <option selected>–ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π</option>
    <option>–ï–≤—Ä–æ / –î–∏–∑–∞–π–Ω</option>
  </select>

  <div class="tab-buttons">
    <div class="tab-button active" onclick="showTab('base')">–ß–µ—Ä–Ω–æ–≤—ã–µ</div>
    <div class="tab-button" onclick="showTab('finish')">–ß–∏—Å—Ç–æ–≤—ã–µ</div>
    <div class="tab-button" onclick="showTab('plumbing')">–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</div>
    <div class="tab-button" onclick="showTab('electric')">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞</div>
  </div>

  <div id="works-container"></div>

  <div id="result">–ò—Ç–æ–≥–æ: 0 ‚ÇΩ</div>
  <button onclick="sendData()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç</button>
</div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  // –ü–û–õ–ù–ê–Ø –ë–ê–ó–ê –†–ê–ë–û–¢ –ò–ó –¢–í–û–ï–ì–û –ü–ï–†–í–û–ì–û –°–ö–†–ò–ü–¢–ê
  const WORKS_DB = {
    base: [
      { name: "–®–ø–∞—Ç–ª–µ–≤–∫–∞ —Å—Ç–µ–Ω", price: 470 },
      { name: "–®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ –ø–æ –º–∞—è–∫–∞–º", price: 970 },
      { name: "–ì—Ä—É–Ω—Ç–æ–≤–∫–∞", price: 120 },
      { name: "–°—Ç—è–∂–∫–∞ –ø–æ–ª–∞", price: 1000 },
      { name: "–î–µ–º–æ–Ω—Ç–∞–∂ (—Å—Ç–µ–Ω—ã)", price: 550 }
    ],
    finish: [
      { name: "–ü–æ–∫—Ä–∞—Å–∫–∞ —Å—Ç–µ–Ω", price: 450 },
      { name: "–û–±–æ–∏", price: 420 },
      { name: "–£–∫–ª–∞–¥–∫–∞ –ª–∞–º–∏–Ω–∞—Ç–∞/–∫–≤–∞—Ä—Ü–≤–∏–Ω–∏–ª–∞", price: 1380 },
      { name: "–ü–ª–∏—Ç–∫–∞ (—É–∫–ª–∞–¥–∫–∞)", price: 3000 },
      { name: "–ó–∞—Ç–∏—Ä–∫–∞ —à–≤–æ–≤", price: 350 }
    ],
    plumbing: [
      { name: "–†–∞–∑–≤–æ–¥–∫–∞ —Ç—Ä—É–± (—Ç–æ—á–∫–∞)", price: 3500 },
      { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∞–Ω–Ω—ã", price: 12000 },
      { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏", price: 15000 },
      { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–º–µ—Å–∏—Ç–µ–ª—è", price: 2700 }
    ],
    electric: [
      { name: "–®—Ç—Ä–æ–±–ª–µ–Ω–∏–µ", price: 700 },
      { name: "–ú–æ–Ω—Ç–∞–∂ –ø–æ–¥—Ä–æ–∑–µ—Ç–Ω–∏–∫–∞", price: 650 },
      { name: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–∑–µ—Ç–∫–∏/–≤—ã–∫–ª", price: 390 },
      { name: "–ü—Ä–æ–∫–ª–∞–¥–∫–∞ –∫–∞–±–µ–ª—è", price: 150 }
    ]
  };

  let activeTab = 'base';
  let selectedWorks = {}; // –•—Ä–∞–Ω–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–∞–ª–æ—á–µ–∫

  function showTab(tabName) {
    activeTab = tabName;
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
    document.querySelector(`.tab-button[onclick="showTab('${tabName}')"]`).classList.add('active');
    render();
  }

  function render() {
    const list = WORKS_DB[activeTab];
    let html = '';
    list.forEach(item => {
      const isChecked = selectedWorks[item.name] ? 'checked' : '';
      html += `
        <div class="work-item">
          <div>
            <div>${item.name}</div>
            <div class="price">${item.price} ‚ÇΩ/–µ–¥.</div>
          </div>
          <input type="checkbox" onchange="toggle('${item.name}', ${item.price}, this.checked)" ${isChecked}>
        </div>
      `;
    });
    document.getElementById('works-container').innerHTML = html;
  }

  function toggle(name, price, checked) {
    if (checked) selectedWorks[name] = price;
    else delete selectedWorks[name];
    calc();
  }

  function calc() {
    const area = parseFloat(document.getElementById('area').value) || 0;
    let total = 0;
    
    // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É: —Ü–µ–Ω–∞ —Ä–∞–±–æ—Ç—ã * –ø–ª–æ—â–∞–¥—å (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ç–µ—Å—Ç–∞ —Å—á–∏—Ç–∞–µ–º –≤—Å—ë –æ—Ç –ø–ª–æ—â–∞–¥–∏)
    // –í –∏–¥–µ–∞–ª–µ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –∏–Ω–ø—É—Ç—ã –∫–æ–ª-–≤–∞, –Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ —Å–º–µ—Ç—ã —ç—Ç–æ –Ω–∞–¥–µ–∂–Ω–µ–µ
    for (let price of Object.values(selectedWorks)) {
      total += price * area;
    }
    
    document.getElementById('result').innerText = `–ò—Ç–æ–≥–æ: ${total.toLocaleString()} ‚ÇΩ`;
    return total;
  }

  function sendData() {
    const area = document.getElementById('area').value;
    const rooms = document.getElementById('rooms').value;
    const type = document.getElementById('repairType').value;
    const total = document.getElementById('result').innerText;
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫–∞–º–∏
    let details = [];
    for (let [name, price] of Object.entries(selectedWorks)) {
        details.push(`${name}: ${price}—Ä * ${area}–º`);
    }

    if (details.length === 0) {
        tg.showPopup({message: "–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ä–∞–±–æ—Ç—É!"});
        return;
    }

    const data = {
        area: area,
        rooms: rooms,
        repairType: type,
        total: total,
        details: details
    };
    
    tg.sendData(JSON.stringify(data));
  }

  // –ó–∞–ø—É—Å–∫
  render();
</script>

</body>
</html>